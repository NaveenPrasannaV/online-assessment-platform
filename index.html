<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NTC Online Examination Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ‚úÖ Lexend font (only used for technoSoft brand text) -->
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    /* ‚úÖ Fix overflow issue (inputs/buttons won't go out of box) */
    * { box-sizing: border-box; }

    body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(135deg, #0f172a, #1e293b);
        color: white;
        min-height: 100vh;
        padding: 30px;
    }

    .main {
        max-width: 650px;
        margin: auto;
        background: rgba(255,255,255,0.06);
        padding: 40px;
        border-radius: 25px;
        backdrop-filter: blur(12px);
        box-shadow: 0 0 25px rgba(0,0,0,0.4);
    }

    h1 {
        text-align: center;
        font-size: 28px;
        margin-bottom: 5px;
        font-weight: 700;
    }

    h3 {
        text-align: center;
        margin-top: 0;
        font-weight: 400;
        opacity: 0.85;
    }

    .section {
        margin-top: 25px;
        background: rgba(255,255,255,0.08);
        padding: 20px;
        border-radius: 15px;
    }

    label {
        display: block;
        margin-top: 15px;
        font-size: 14px;
    }

    input {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: none;
        margin-top: 5px;
        outline: none;
    }

    #signinBtn {
        width: 100%;
        margin-top: 20px;
        padding: 12px;
        background: #38bdf8;
        border: none;
        border-radius: 10px;
        font-size: 17px;
        font-weight: bold;
        cursor: pointer;
        color: #000;
    }

    #linkBtn {
        display: none;
        margin-top: 20px;
        padding: 12px;
        background: #22c55e;
        text-align: center;
        border-radius: 10px;
        font-size: 17px;
        font-weight: bold;
        cursor: pointer;
    }

    #errorBox {
        margin-top: 15px;
        padding: 12px;
        background: rgba(255,0,0,0.18);
        border-left: 4px solid #ef4444;
        border-radius: 8px;
        display: none;
        font-size: 14px;
    }

    #countdown {
        text-align: center;
        font-size: 20px;
        margin-top: 10px;
        font-weight: bold;
        color: #38bdf8;
    }

    .brand {
        text-align: right;
        margin-top: 20px;
        font-size: 12px;
        opacity: 0.7;
        font-family: "Lexend", "Segoe UI", Arial, sans-serif;
    }

    /* ‚úÖ Candidate Photo Capture UI styles */
    #photoCaptureBox {
        margin-top: 12px;
        margin-bottom: 18px;
        padding: 14px;
        border-radius: 12px;
        background: rgba(255,255,255,0.06);
    }

    #captureBtn {
        width: 100%;
        padding: 12px;
        background: #fbbf24;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        color: #000;
    }

    #camVideo, #capturedPhoto {
        width: 100%;
        margin-top: 12px;
        border-radius: 12px;
        border: 2px solid rgba(255,255,255,0.2);
        object-fit: cover;
        display: none;
    }
</style>
</head>

<body>

<div class="main">

    <h1>NTC Online Examination Portal</h1>
    <h3>National Testing Commission (Engineering Division)</h3>

    <!-- ‚úÖ Exam LIVE now -->
    <div id="countdown">‚úî Examination is LIVE now!</div>

    <!-- Exam Details -->
    <div class="section">
        <h2 style="margin-top:0;">üìò Examination Details</h2>
        <p><b>Examination Name:</b> Engineering Entrance Examination</p>
        <p><b>Examination Code:</b> <span style="color:#38bdf8;">EEE001-CSE&IT</span></p>
        <p><b>Examination Status:</b> <span style="color:#22c55e; font-weight:bold;">LIVE</span></p>
        <p><b>Total Duration:</b> <span style="color:#fbbf24; font-weight:bold;">5 minutes</span></p>
        <p><b>Mode:</b> Online Secure Assessment</p>
        <p><b>Note:</b> Candidate can take this exam anytime.</p>
    </div>

    <!-- Instructions -->
    <div class="section">
        <h2 style="margin-top:0;">üìù Important Instructions</h2>
        <ul>
            <li>Sign in using your valid <b>Shiksha ID</b> and <b>OTEP</b>.</li>
            <li>Capture your photo before starting.</li>
            <li>Exam duration is strictly <b>5 minutes</b>.</li>
            <li>Do not refresh or close the browser during the examination.</li>
            <li>Ensure a stable and uninterrupted internet connection.</li>
        </ul>
    </div>

    <!-- Login Section -->
    <div class="section">
        <h2 style="margin-top:0;">üîê Candidate Sign In</h2>

        <!-- ‚úÖ Photo Capture (Before Sign-in Form) -->
        <div id="photoCaptureBox">
            <button id="captureBtn" type="button">Capture Photo</button>

            <video id="camVideo" autoplay playsinline></video>
            <canvas id="camCanvas" style="display:none;"></canvas>
            <img id="capturedPhoto" />
        </div>

        <label>Shiksha ID</label>
        <input type="text" id="shikshaId" placeholder="Enter your Shiksha ID">

        <label>OTEP (One-Time Examination Password)</label>
        <input type="password" id="otep" placeholder="DDMMYYYY">

        <button id="signinBtn" onclick="signin()">Sign In</button>

        <div id="errorBox"></div>

        <div id="linkBtn" onclick="openExam()">Open Examination</div>
    </div>

    <div class="brand">technoSoft</div>

</div>

<script>
    /* Authorized Credentials */
    const correctID = "NTC980320";
    const correctOTEP = "20031998";

    /* ‚úÖ Exam link */
    const EXAM_LINK = "https://gemini.google.com/share/d22a910890a8";

    /* ‚úÖ 5 minutes duration */
    const EXAM_DURATION_MS = 5 * 60 * 1000;

    let examStartTime = null;

    /* ==========================
       ‚úÖ NEW FEATURE: Exam Sounds
       ========================== */
    function playBeep({ frequency = 880, duration = 200, volume = 0.25, type = "sine" } = {}) {
        try {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const ctx = new AudioContext();

            const osc = ctx.createOscillator();
            const gain = ctx.createGain();

            osc.type = type;
            osc.frequency.value = frequency;
            gain.gain.value = volume;

            osc.connect(gain);
            gain.connect(ctx.destination);

            osc.start();
            setTimeout(() => {
                osc.stop();
                ctx.close();
            }, duration);
        } catch (e) {
            console.warn("Audio blocked or not supported:", e);
        }
    }

    // ‚úÖ Exam opened sound
    function playExamStartSound() {
        playBeep({ frequency: 950, duration: 180, volume: 0.20, type: "sine" });
        setTimeout(() => playBeep({ frequency: 1200, duration: 120, volume: 0.18, type: "sine" }), 200);
    }

    // ‚úÖ 10 seconds remaining warning sound
    function playTenSecWarningSound() {
        playBeep({ frequency: 700, duration: 140, volume: 0.35, type: "triangle" });
        setTimeout(() => playBeep({ frequency: 700, duration: 140, volume: 0.35, type: "triangle" }), 180);
        setTimeout(() => playBeep({ frequency: 900, duration: 200, volume: 0.40, type: "triangle" }), 380);
    }

    // ‚úÖ Exam over warning sound
    function playExamOverSound() {
        playBeep({ frequency: 350, duration: 300, volume: 0.45, type: "square" });
        setTimeout(() => playBeep({ frequency: 350, duration: 300, volume: 0.45, type: "square" }), 380);
        setTimeout(() => playBeep({ frequency: 350, duration: 450, volume: 0.55, type: "square" }), 760);
    }

    /* ==========================
       ‚úÖ NEW FEATURE: Fullscreen Lock
       ========================== */
    async function enterFullscreen() {
        try {
            const el = document.documentElement;
            if (!document.fullscreenElement) {
                if (el.requestFullscreen) return el.requestFullscreen();
                if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen(); // Safari
            }
        } catch (e) {
            console.warn("Fullscreen blocked:", e);
        }
    }

    async function exitFullscreen() {
        try {
            if (document.fullscreenElement) {
                if (document.exitFullscreen) return document.exitFullscreen();
                if (document.webkitExitFullscreen) return document.webkitExitFullscreen();
            }
        } catch (e) {
            console.warn("Exit fullscreen blocked:", e);
        }
    }

    let fullscreenLockEnabled = false;

    function enableFullscreenLock() {
        fullscreenLockEnabled = true;

        document.addEventListener("fullscreenchange", async () => {
            if (fullscreenLockEnabled && !document.fullscreenElement) {
                // ‚úÖ user pressed ESC => force fullscreen again
                await enterFullscreen();
            }
        });
    }

    function signin() {
        const id = document.getElementById("shikshaId").value.trim();
        const otp = document.getElementById("otep").value.trim();
        const errorBox = document.getElementById("errorBox");
        const linkBtn = document.getElementById("linkBtn");

        if (id === correctID && otp === correctOTEP) {
            errorBox.style.display = "none";
            linkBtn.style.display = "block";
        } else {
            linkBtn.style.display = "none";
            errorBox.style.display = "block";
            errorBox.innerHTML = "‚ùå Invalid Shiksha ID or OTEP. Please try again.";
        }
    }

    function openExam() {
        const errorBox = document.getElementById("errorBox");

        // ‚úÖ enable fullscreen lock + go fullscreen
        enableFullscreenLock();
        enterFullscreen();

        // ‚úÖ sound immediately when exam opens
        playExamStartSound();

        // ‚úÖ start exam timer
        examStartTime = Date.now();
        const endTime = examStartTime + EXAM_DURATION_MS;

        errorBox.style.display = "block";
        errorBox.style.background = "rgba(0,255,0,0.12)";
        errorBox.style.borderLeft = "4px solid #22c55e";
        errorBox.innerHTML = "‚úÖ Exam Started! You have <b>5 minutes</b>. Opening now...";

        // ‚úÖ open exam link
        window.open(EXAM_LINK, "_blank");

        // ‚úÖ show remaining time in top
        const countdown = document.getElementById("countdown");

        let tenSecWarningPlayed = false;

        const timer = setInterval(() => {
            const now = Date.now();
            const remaining = endTime - now;

            // ‚úÖ Play warning once at 10 seconds remaining
            if (!tenSecWarningPlayed && remaining <= 10000 && remaining > 0) {
                tenSecWarningPlayed = true;
                playTenSecWarningSound();
            }

            if (remaining <= 0) {
                countdown.innerHTML = "‚è≥ Time Over (5 minutes completed)";

                // ‚úÖ loud exam over warning sound
                playExamOverSound();

                // ‚úÖ release fullscreen lock after exam ends
                fullscreenLockEnabled = false;
                exitFullscreen();

                clearInterval(timer);
                return;
            }

            const mm = Math.floor(remaining / (1000 * 60));
            const ss = Math.floor((remaining % (1000 * 60)) / 1000);

            countdown.innerHTML = `‚è± Remaining Time: ${mm}m : ${ss}s`;
        }, 1000);
    }

    /* ==========================
       ‚úÖ Photo capture logic
       ========================== */
    (function () {
        const captureBtn = document.getElementById("captureBtn");
        const video = document.getElementById("camVideo");
        const canvas = document.getElementById("camCanvas");
        const photo = document.getElementById("capturedPhoto");

        let stream = null;
        let isCameraOn = false;

        async function startCamera() {
            stream = await navigator.mediaDevices.getUserMedia({
                video: true,
                audio: false
            });

            video.srcObject = stream;
            video.style.display = "block";
            photo.style.display = "none";

            await new Promise(resolve => {
                video.onloadedmetadata = () => resolve();
            });

            await video.play();
            isCameraOn = true;
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(t => t.stop());
                stream = null;
            }
            video.srcObject = null;
            video.style.display = "none";
            isCameraOn = false;
        }

        function capturePhoto() {
            const ctx = canvas.getContext("2d");
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            photo.src = canvas.toDataURL("image/png");
            photo.style.display = "block";

            stopCamera();

            // ‚úÖ remove capture button completely (no space)
            captureBtn.style.display = "none";
        }

        captureBtn.addEventListener("click", async () => {
            try {
                if (!isCameraOn) {
                    await startCamera(); // first click -> ON
                } else {
                    capturePhoto(); // second click -> capture -> OFF
                }
            } catch (err) {
                console.error(err);
                stopCamera();
                alert("Camera access error: " + err.message);
            }
        });
    })();
</script>

</body>
</html>
